/*! flickrgal 2018-04-28 */
"undefined"!=typeof window&&window.addEventListener("load",function(a){function b(a){function b(a){var b=a.target,c=JSON.parse(b.responseText);if(b.readyState===XMLHttpRequest.DONE)if(200===b.status)switch(b.type){case"collections":n(c);var d=E.childNodes;Array.prototype.forEach.call(d,function(a){u.push(a)});break;case"photosets":o(c,b.id)}else console.log("Flickr "+b.type+" request failed!")}function c(a,b){var c="https://api.flickr.com/services/rest/?method=";switch(a){case"collections":c+="flickr.collections.getTree";break;case"photosets":c+="flickr.photosets.getPhotos&photoset_id="+b+"&extras=description"}return c+="&format=json&nojsoncallback=1&api_key="+e+"&user_id="+f}function d(a,d){var e=new XMLHttpRequest;e.open("GET",c(a,d),!0),e.type=a,e.id=d,e.onload=b,e.send()}var e=a.apiKey,f=a.userId;return{makeApiRequest:d}}function c(a){return document.querySelector(a)}function d(a){var b=a.currentTarget,c=b.className;switch(console.log(c),c){case"navigate-back":E.innerHTML="";for(var d in u)E.appendChild(u[d]);console.log("yip"),G.style.display="none";break;case"album":window.pageYOffset=document.documentElement.scrollTop=document.body.scrollTop=0;p(b.id);break;case"image":q(b.id,b.getAttribute("album-id")),F.classList.remove("hide"),console.log("yip");break;case"close":F.classList.add("hide");break;case"prev":f();break;case"next":g()}}function e(a){switch(a.keyCode){case 39:g();break;case 37:f();break;case 27:F.classList.add("hide")}}function f(){var a=document.getElementById(t[0]);a.classList.add("hide-stage-image");var b=t.pop();t.unshift(b),a=document.getElementById(t[0]),a.classList.remove("hide-stage-image"),F.imageTitle.innerHTML=a.getAttribute("data-title"),F.imageDesc.innerHTML=a.getAttribute("data-description")}function g(){var a=document.getElementById(t[0]);a.classList.add("hide-stage-image");var b=t.shift();t.push(b),a=document.getElementById(t[0]),a.classList.remove("hide-stage-image"),F.imageTitle.innerHTML=a.getAttribute("data-title"),F.imageDesc.innerHTML=a.getAttribute("data-description")}function h(a){this.el=document.createElement("div"),this.el.className=a,this.loading=document.createElement("div"),this.loading.className="image-loading",this.inner=document.createElement("div"),this.inner.className="inner",this.dummy=document.createElement("div"),this.dummy.className="dummy",this.title=document.createElement("div"),this.desc=document.createElement("div")}function i(a){var b="";for(var c in s)s[c].id==a&&(b=c);return b}function j(a){for(name in a)a[name]=a[name].toString().toLowerCase();return a}function k(a,b){var c=document.getElementById(a);c.style.backgroundImage="url("+b+")";var d=c.querySelector(".image-loading");!!d&&(d.style.opacity=0)}function l(a,b){return"https://farm"+a.farm+".staticflickr.com/"+a.server+"/"+a.id+"_"+a.secret+"_"+b+".jpg"}function m(a,b,c){var d=a.set;for(C in d)s.push({id:d[C].id,collectionName:b,collectionID:c,title:d[C].title,description:d[C].description,images:[]});D&&E.insertAdjacentHTML("beforeend",'<h3 class="collection-title">'+b+'</h3><div class="collection collection-'+c+'"></div>')}function n(a){var b=a.collections.collection;for(var c in b){var e=b[c],f=e.title,g=e.id;z?m(e,f,g):C.indexOf(f.toLowerCase())>=0&&m(e,f,g)}G.style.display="none",Array.prototype.forEach.call(s,function(a){var b=new h("album");b.el.id=a.id,b.title.innerHTML=a.title,b.el.setAttribute("collection-name",a.collectionName),b.el.setAttribute("collection-id",a.collectionID),b.inner.appendChild(b.title),b.el.appendChild(b.loading),b.el.appendChild(b.dummy),b.el.appendChild(b.inner),b.el.addEventListener("click",d),D?E.querySelector(".collection-"+b.el.getAttribute("collection-id")).appendChild(b.el):E.appendChild(b.el)}),Array.prototype.forEach.call(s,function(a){r.gallery.makeApiRequest("photosets",a.id)}),y.classList.remove("hide")}function o(a,b){var c=i(b),d=a.photoset.photo;Array.prototype.forEach.call(d,function(a){var d,e={};e.id=a.id,e.farm=a.farm,e.server=a.server,e.secret=a.secret,e.title=a.title,e.description=a.description,e.is_primary=a.isprimary,s[c].images.push(e),1==e.is_primary?(d=l(e,"c"),k(b,d)):(d=l(s[c].images[0],"c"),k(b,d))})}function p(a){E.innerHTML="";var b=new h("image");b.inner.classList.remove("inner"),b.inner.classList.add("navigate-back"),b.inner.innerHTML="<div>Back</div>",b.inner.addEventListener("click",d),b.el.appendChild(b.dummy),b.el.appendChild(b.inner),E.appendChild(b.el);var c=i(a),e=s[c].images;Array.prototype.forEach.call(e,function(b){var c=l(b,"c"),e=new h("image"),f=b.id;e.el.id=f,e.el.setAttribute("album-id",a),e.el.appendChild(e.dummy),e.el.appendChild(e.inner),e.el.addEventListener("click",d),E.appendChild(e.el),k(f,c)})}function q(a,b){t=[];var c=i(b),d=s[c].images,e="stage-"+a;F.image.innerHTML="",Array.prototype.forEach.call(d,function(a){var b=document.getElementById(a.id),c=b.style.backgroundImage,d=document.createElement("div");d.id="stage-"+a.id,d.classList.add("hide-stage-image"),d.style.backgroundImage=c,d.setAttribute("data-title",a.title),d.setAttribute("data-description",a.description._content);var e=l(a,"h");d.innerHTML='<div style="background-image: url('+e+')"></div>',F.image.appendChild(d),t.push(d.id)});var f=t.indexOf(e),g=t.slice(f),h=t.slice(0,f);t=g.concat(h),F.imageTitle.innerHTML=document.getElementById(t[0]).getAttribute("data-title"),F.imageDesc.innerHTML=document.getElementById(t[0]).getAttribute("data-description"),document.getElementById(e).classList.remove("hide-stage-image")}var r={loadGallery:function(a){if(!a.apiKey)throw"Api key not set";if(!a.userId)throw"User ID not set";this.gallery=new b({apiKey:a.apiKey,userId:a.userId}),this.gallery.makeApiRequest("collections")}},s=[],t=[],u=[],v=document.createElement("div");v.id="lightbox",v.className="hide";var w=document.createElement("div");w.id="lightbox-ui";var x=document.createElement("div");x.id="stage",w.innerHTML='<div class="close" title="Close (Esc)"></div><div id="controls"><div id="arrow-left" class="prev" title="Prev"></div><div id="arrow-right" class="next" title="Next"></div></div><div id="info_container"><div id="info"><div id="title"></div><div id="description"></div></div></div>',x.innerHTML='<div id="image-box-container"><div><div id="image-box"></div></div></div>',v.appendChild(w),v.appendChild(x);var y=c("#flickrgal");if(y){y.className="hide";var z,A='<div id="loading-gallery"><div>Loading...</div></div>',B='<div id="image-grid"></div>',C=j(JSON.parse(y.getAttribute("data-collections")));z=C.indexOf("all")>=0;var D=!!y.hasAttribute("data-titles");y.insertAdjacentHTML("afterbegin",A),y.insertAdjacentHTML("beforeend",B),y.appendChild(v);var E=c("#image-grid"),F=c("#lightbox");F.image=c("#image-box"),F.imageTitle=c("#info > #title"),F.imageDesc=c("#info > #description");var G=c("#loading-gallery");[].forEach.call(document.querySelectorAll(".close,.prev,.next"),function(a){a.addEventListener("click",d)}),window.addEventListener("keydown",e),console.log("Requested Collections: "+C),r.loadGallery({apiKey:y.getAttribute("data-apikey"),userId:y.getAttribute("data-userid")})}});
